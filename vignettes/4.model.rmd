# Part 4: Modeling

## Overview 
### Best Model Posterior Probabilities by Prior
```{r postProbs}
analysis$postProbsPlot
```
`r kfigr::figr(label = "postProbs", prefix = TRUE, link = TRUE, type="Table")`: Best model posterior probabilities by parameter prior; model prior = uniform

### Posterior Parameter Inclusion Probabilities by Prior
`r kfigr::figr(label = "bma_pip", prefix = TRUE, link = TRUE, type="Table")`: Posterior inclusion probabilities across parameter priors; model prior = uniform
```{r bma_pip}
knitr::kable(analysis$pipTable, escape = F, digits = 2) %>%
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")
```

### Model Parameter Inclusion Correlation Across Priors
```{r pip_correlations}
corrplot::corrplot(cor(analysis$pipDf), diag = FALSE,
                     order = "hclust", number.cex = 1,
                     addCoef.col = "black", tl.col = "black",
                     tl.srt = 90, tl.pos = "td", tl.cex = 1,
                     method = "color", type = "upper",
                     col = RColorBrewer::brewer.pal(n = 11,
                                                    name = "PiYG"))
```
`r kfigr::figr(label = "pip_correlations", prefix = TRUE, link = TRUE, type="Figure")`: Correlation of posterior parameter inclusion probabilities across parameter priors; model prior = uniform

### Posterior Parameter Inclusion Probabilities by Parameter
```{r bma_pip_top, fig.height=20}
n <- length(analysis$pipPlots)
nCol <- floor(sqrt(n)-1)
do.call("grid.arrange", c(analysis$pipPlots, ncol=nCol))
```
`r kfigr::figr(label = "bma_pip_top", prefix = TRUE, link = TRUE, type="Figure")`: Posterior inclusion probabilities for highest probability parameters


## Predictive Performance
`r kfigr::figr(label = "bmaAnalysis", prefix = TRUE, link = TRUE, type="Table")`: Mean MSE on test set for default priors over `r trials` trials.
```{r bmaAnalysis}
knitr::kable(compare$summary, escape = F, digits = 2) %>%
  kableExtra::kable_styling(bootstrap_options = c("striped"), full_width = T, position = "center")
```

## Prediction Correlation
```{r prediction_correlations}
GGally::ggpairs(data.frame(BMA = as.vector(compare$top$BMA$PREDICT$fit),  
                           BPM = as.vector(compare$top$BPM$PREDICT$fit),  
                           HPM = as.vector(compare$top$HPM$PREDICT$fit),  
                           MPM = as.vector(compare$top$MPM$PREDICT$fit)))  
```
`r kfigr::figr(label = "prediction_correlations", prefix = TRUE, link = TRUE, type="Figure")`: Prediction correlations of the top models.

## Parameter Inclusion Probabilities
### Parameter Density
### Model Coefficient CI plots
### Residual vs Fitted
### Interpretation of Coefficients.

* * *
